<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>신바위 문제</title>

  <!-- PWA 연결 (GitHub Pages 하위 경로에 맞춰 절대경로 사용) -->
  <link rel="manifest" href="/shinbawiproblems/manifest.json" />
  <meta name="theme-color" content="#0d47a1" />

  <!-- 서비스워커 등록 -->
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("/shinbawiproblems/sw.js").catch(()=>{});
    }
  </script>

  <!-- ★ 자동 이동(리다이렉트) 금지: meta refresh, window.location, setTimeout 이동 코드 일절 없음 -->
</head>
<body style="font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Malgun Gothic,Arial,sans-serif; background:#fafafa;">
  <section style="max-width:960px;margin:40px auto;padding:16px;display:grid;grid-template-columns:1fr 1fr;gap:16px;align-items:center">
    <!-- 왼쪽: 구글드라이브 입장 -->
    <a href="https://drive.google.com/"
       style="display:block;text-align:center;padding:18px 16px;border:1px solid #e5e7eb;border-radius:12px;text-decoration:none;font-weight:700;background:#fff;">
      구글드라이브 입장
    </a>

    <!-- 오른쪽: 앱 설치 버튼 -->
    <button id="installBtn" disabled
            style="padding:18px 16px;border:none;border-radius:12px;font-weight:800;background:#0d47a1;color:#fff;cursor:not-allowed">
      앱 설치
    </button>

    <!-- 상태 메시지 -->
    <div id="installMsg" style="grid-column:1 / -1;color:#64748b;font-size:14px"></div>
  </section>

  <script>
    // iOS Safari는 beforeinstallprompt 미지원 → 안내만 표시
    const isiOS = /iphone|ipad|ipod/i.test(navigator.userAgent);
    const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);

    const installBtn = document.getElementById("installBtn");
    const installMsg = document.getElementById("installMsg");
    let deferredPrompt = null;

    if (isiOS && isSafari) {
      installBtn.disabled = true;
      installBtn.style.cursor = "not-allowed";
      installMsg.innerHTML = "iPhone/Safari는 <b>공유 버튼(⬆️) → 홈 화면에 추가</b>로 설치합니다.";
    }

    // 설치 가능 신호 오면 버튼 활성화
    window.addEventListener("beforeinstallprompt", (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installBtn.disabled = false;
      installBtn.style.cursor = "pointer";
      installMsg.textContent = "앱 설치가 가능합니다. 버튼을 눌러 설치하세요.";
    });

    // 설치 버튼 클릭 → 설치 팝업
    installBtn.addEventListener("click", async () => {
      if (!deferredPrompt) {
        installMsg.textContent = "아직 설치 준비 중입니다. 새로고침(Ctrl+Shift+R) 후 다시 시도하세요.";
        return;
      }
      deferredPrompt.prompt();
      const { outcome } = await deferredPrompt.userChoice;
      installMsg.textContent = (outcome === "accepted") ? "설치를 진행합니다…" : "설치를 취소했습니다.";
      deferredPrompt = null;
      installBtn.disabled = true;
      installBtn.style.cursor = "not-allowed";
    });

    // 설치 완료 이벤트
    window.addEventListener("appinstalled", () => {
      installMsg.textContent = "설치 완료! 바탕화면/앱 목록에서 실행하세요.";
      installBtn.disabled = true;
      installBtn.style.cursor = "not-allowed";
    });
  </script>
</body>
</html>
