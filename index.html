<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì‹ ë°”ìœ„ ë¬¸ì œ</title>

  <!-- PWA ì—°ê²° -->
  <link rel="manifest" href="/shinbawiproblems/manifest.json" />
  <meta name="theme-color" content="#0d47a1" />

  <!-- ì„œë¹„ìŠ¤ì›Œì»¤ ë“±ë¡ -->
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("/shinbawiproblems/sw.js").catch(()=>{});
    }
  </script>
</head>
<body style="font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Malgun Gothic,Arial,sans-serif; background:#fafafa;">

  <script>
    // ì•± ëª¨ë“œì¸ì§€ í™•ì¸ (ì„¤ì¹˜ëœ PWA ì‹¤í–‰ ì—¬ë¶€)
    const isStandalone =
      window.matchMedia("(display-mode: standalone)").matches ||
      window.navigator.standalone;

    if (isStandalone) {
      // ì•±ìœ¼ë¡œ ì‹¤í–‰ë˜ë©´ ë°”ë¡œ ì‹ ë°”ìœ„ ì—°êµ¬ì†Œ êµ¬ê¸€ë“œë¼ì´ë¸Œë¡œ ì´ë™
      window.location.href = "https://drive.google.com/drive/folders/1Iax6j8wGi6z6mV21craLi7TY0u9sW_3K";
    }
  </script>

  <!-- ì•± ì„¤ì¹˜ ì „ì´ë¼ë©´ ì²« í™”ë©´ -->
  <section style="max-width:960px;margin:40px auto;padding:16px;display:grid;grid-template-columns:1fr 1fr;gap:16px;align-items:center">
    <!-- ì™¼ìª½: ì‹ ë°”ìœ„ ì—°êµ¬ì†Œ êµ¬ê¸€ë“œë¼ì´ë¸Œ -->
    <a href="https://drive.google.com/drive/folders/1Iax6j8wGi6z6mV21craLi7TY0u9sW_3K"
       style="display:block;text-align:center;padding:18px 16px;border:1px solid #e5e7eb;border-radius:12px;text-decoration:none;font-weight:700;background:#fff;">
      ì‹ ë°”ìœ„ ì—°êµ¬ì†Œ ì…ì¥
    </a>

    <!-- ì˜¤ë¥¸ìª½: ì•± ì„¤ì¹˜ ë²„íŠ¼ -->
    <button id="installBtn" disabled
            style="padding:18px 16px;border:none;border-radius:12px;font-weight:800;background:#0d47a1;color:#fff;cursor:not-allowed">
      ì•± ì„¤ì¹˜
    </button>

    <!-- ìƒíƒœ ë©”ì‹œì§€ -->
    <div id="installMsg" style="grid-column:1 / -1;color:#64748b;font-size:14px"></div>
  </section>

  <script>
    const isiOS = /iphone|ipad|ipod/i.test(navigator.userAgent);
    const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);

    const installBtn = document.getElementById("installBtn");
    const installMsg = document.getElementById("installMsg");
    let deferredPrompt = null;

    if (isiOS && isSafari) {
      installBtn.disabled = true;
      installBtn.style.cursor = "not-allowed";
      installMsg.innerHTML = "iPhone/SafariëŠ” <b>ê³µìœ  ë²„íŠ¼(â¬†ï¸) â†’ í™ˆ í™”ë©´ì— ì¶”ê°€</b>ë¡œ ì„¤ì¹˜í•˜ì„¸ìš”.";
    }

    window.addEventListener("beforeinstallprompt", (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installBtn.disabled = false;
      installBtn.style.cursor = "pointer";
      installMsg.textContent = "ì•± ì„¤ì¹˜ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤. ë²„íŠ¼ì„ ëˆŒëŸ¬ ì„¤ì¹˜í•˜ì„¸ìš”.";
    });

    installBtn.addEventListener("click", async () => {
      if (!deferredPrompt) {
        installMsg.textContent = "ì•„ì§ ì„¤ì¹˜ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨(Ctrl+Shift+R) í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.";
        return;
      }
      deferredPrompt.prompt();
      const { outcome } = await deferredPrompt.userChoice;
      installMsg.textContent = (outcome === "accepted") ? "ì„¤ì¹˜ë¥¼ ì§„í–‰í•©ë‹ˆë‹¤â€¦" : "ì„¤ì¹˜ë¥¼ ì·¨ì†Œí–ˆìŠµë‹ˆë‹¤.";
      deferredPrompt = null;
      installBtn.disabled = true;
      installBtn.style.cursor = "not-allowed";
    });

    window.addEventListener("appinstalled", () => {
      installMsg.textContent = "ì„¤ì¹˜ ì™„ë£Œ! ë°”íƒ•í™”ë©´/ì•± ëª©ë¡ì—ì„œ ì‹¤í–‰í•˜ì„¸ìš”.";
      installBtn.disabled = true;
      installBtn.style.cursor = "not-allowed";
    });
  </script>
  <script>
(function () {
  const isKakao = /KAKAOTALK/i.test(navigator.userAgent);
  if (!isKakao) return;

  const isAndroid = /Android/i.test(navigator.userAgent);
  const isIOS     = /iPhone|iPad|iPod/i.test(navigator.userAgent);
  const targetUrl = "https://drive.google.com/drive/folders/1Iax6j8wGi6z6mV21craLi7TY0u9sW_3K";

  const chromeIntent =
    "intent://" + targetUrl.replace(/^https?:\/\//, "") +
    "#Intent;scheme=https;package=com.android.chrome;" +
    "S.browser_fallback_url=" +
    encodeURIComponent("https://play.google.com/store/apps/details?id=com.android.chrome") +
    ";end";

  // ì „ì²´ ì˜¤ë²„ë ˆì´
  const $wrap = document.createElement("div");
  $wrap.style.cssText = `
    position: fixed; inset: 0; z-index: 9999;
    background: #000; display:flex; align-items:center; justify-content:center;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Apple SD Gothic Neo, Malgun Gothic, Arial, sans-serif;
  `;

  // ì•ˆë‚´ ë°•ìŠ¤
  const $sheet = document.createElement("div");
  $sheet.style.cssText = `
    width:min(560px, 92vw); background:#111; color:#f1f5f9;
    border-radius:20px; padding:28px; box-shadow:0 6px 32px rgba(0,0,0,.7);
    text-align:center;
  `;

  const tip = isAndroid
    ? "ìš°ì¸¡ ìƒë‹¨ ì  3ê°œ â†’ <b>ë‹¤ë¥¸ ë¸Œë¼ìš°ì €ë¡œ ì—´ê¸°</b> â†’ <b>Chrome</b>"
    : "ê³µìœ  ë²„íŠ¼(â¬†ï¸) â†’ <b>Safariì—ì„œ ì—´ê¸°</b> ë˜ëŠ” <b>í™ˆ í™”ë©´ì— ì¶”ê°€</b>";

  $sheet.innerHTML = `
    <h2 style="margin:0 0 16px;font-size:22px;font-weight:800;color:#fff;">ì¹´ì¹´ì˜¤í†¡ ì¸ì•± ë¸Œë¼ìš°ì € ê°ì§€ë¨</h2>
    <p style="margin:0 0 24px;line-height:1.6;color:#cbd5e1;font-size:15px;">
      ì›í™œí•œ ì‚¬ìš©ì„ ìœ„í•´ <b style="color:#38bdf8">${isAndroid ? "Chrome" : "Safari"}</b>ì—ì„œ ì—´ì–´ì£¼ì„¸ìš”.<br>
      <span style="font-size:14px;color:#94a3b8">${tip}</span>
    </p>

    <div style="display:grid; gap:14px;">
      ${isAndroid ? `
        <a href="${chromeIntent}"
           style="display:block;padding:14px 0;border-radius:12px;
                  background:#0d47a1;color:#fff;font-weight:700;text-decoration:none;">
          ğŸš€ Chromeìœ¼ë¡œ ì—´ê¸°
        </a>
      ` : `
        <button id="copyLinkBtn"
                style="padding:14px 0;border-radius:12px;border:1px solid #333;
                       background:#222;color:#f1f5f9;font-weight:700;cursor:pointer;">
          ğŸ“‹ ë§í¬ ë³µì‚¬ â†’ Safari ë¶™ì—¬ë„£ê¸°
        </button>
      `}
      <a href="${targetUrl}"
         style="display:block;padding:12px 0;border-radius:12px;
                border:1px solid #333;background:#1e293b;color:#e2e8f0;font-weight:600;text-decoration:none;">
        ê·¸ëƒ¥ ì´ ì°½ì—ì„œ ì—´ê¸° (ì¸ì•±)
      </a>
      <button id="closeKakaoOverlay"
              style="padding:10px 0;border-radius:12px;border:none;
                     background:#334155;color:#f8fafc;font-weight:600;cursor:pointer;">
        ë‹«ê¸°
      </button>
    </div>

    <p style="margin-top:20px;font-size:12px;color:#64748b;">
      ì„¤ì¹˜(PWA) í›„ì—ëŠ” ì²« í™”ë©´ ì—†ì´ ìë™ìœ¼ë¡œ ì‹ ë°”ìœ„ ì—°êµ¬ì†Œë¡œ ì—´ë¦½ë‹ˆë‹¤.
    </p>
  `;

  $wrap.appendChild($sheet);
  document.body.appendChild($wrap);

  // iOS: ë§í¬ ë³µì‚¬
  if (isIOS) {
    const copyBtn = $sheet.querySelector("#copyLinkBtn");
    copyBtn?.addEventListener("click", async () => {
      try {
        await navigator.clipboard.writeText(targetUrl);
        copyBtn.textContent = "âœ… ë³µì‚¬ë¨! Safariì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”";
        copyBtn.style.background = "#064e3b";
        copyBtn.style.color = "#fff";
      } catch {
        alert("ë³µì‚¬ ì‹¤íŒ¨: ì£¼ì†Œì°½ì„ ê¸¸ê²Œ ëˆŒëŸ¬ ì§ì ‘ ë³µì‚¬í•´ì£¼ì„¸ìš”.");
      }
    });
  }

  // ë‹«ê¸° ë²„íŠ¼
  $sheet.querySelector("#closeKakaoOverlay")?.addEventListener("click", () => {
    document.body.removeChild($wrap);
  });
})();
</script>

</body>
</html>
